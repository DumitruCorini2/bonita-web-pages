plugins {
    id 'com.moowork.node'
}

project.beforeEvaluate {
    project.node {
        version = '8.9.4'
        npmVersion = '6.2.0'
    }
}

project.node {
    download = true
    def currentDir = project.rootProject.projectDir
    workDir = project.file("${currentDir}/.gradle/nodejs")
    npmWorkDir = project.file("${currentDir}/.gradle/npm")
}

project.tasks.npm_install.configure {
    group 'Bonita'
    description 'Install node moodule for this project'
    inputs.files('package.json', 'package-lock.json')
    outputs.dirs('node_modules')
}

def runIntegrationTests = task runIntegrationTests {}

def parentProject = project

subprojects { subProject ->
    apply plugin: 'com.moowork.node'
    apply plugin: 'com.bonitasoft.deployer.bonita-resources-deployer'
    apply plugin: 'com.bonitasoft.gradle.bonita-uid-page'

    UIDPage {
        resources {
            from("src/resources"){
                include '**/*'
            }
        }
    }

    publish.dependsOn buildUIDPage
    publishToMavenLocal.dependsOn buildUIDPage

    publishing {
        publications {
            create('zip', MavenPublication) {
                artifact file("${project.buildDir}/${project.name}-${project.version}.zip")
            }
        }
    }

    deployPage.dependsOn buildUIDPage
    bonitaArtifacts {
        page  =  file("${subProject.buildDir}/${subProject.name}-${project.version}.zip")
    }
}